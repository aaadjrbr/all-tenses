<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EN↔PT Tense Navigator</title>
  <!-- Google Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;600;700&family=Rubik:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@300;400;600" rel="stylesheet" />
  <style>
    :root{
      --bg:#0b1020; /* deep blue/ink */
      --panel:#121933;
      --muted:#8ea0c9;
      --text:#e9eefc;
      --brand:#79ffe1;
      --brand-2:#a78bfa;
      --chip:#1c2650;
      --ok:#3ddc97;
      --warn:#ffd166;
      --danger:#ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 700px at 20% -10%, #1b2450 0%, #0b1020 55%), var(--bg);color:var(--text);font-family: Figtree, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;}
    a{color:inherit}
    .app{display:grid;grid-template-columns: 280px 1fr; gap:20px; padding:20px; max-width:1200px;margin:0 auto}

    /* Sidebar */
    .side{background:linear-gradient(180deg,#131a38 0,#0e1530 100%);border:1px solid #243061;border-radius:var(--radius);box-shadow:var(--shadow);position:sticky;top:20px;height:calc(100dvh - 40px);overflow:auto}
    .side header{padding:18px 18px 6px;border-bottom:1px solid #243061}
    .logo{display:flex;align-items:center;gap:10px}
    .logo .spark{display:inline-grid;place-items:center;width:34px;height:34px;border-radius:12px;background:conic-gradient(from 120deg, var(--brand), var(--brand-2));box-shadow:0 6px 16px rgba(121,255,225,.35)}
    .muted{color:var(--muted)}
    .tense-list{padding:10px}
    .tense-item{display:flex;align-items:center;gap:10px;padding:10px;border-radius:12px;cursor:pointer;border:1px solid transparent}
    .tense-item:hover{background:#0f1735}
    .tense-item.active{background:#0f1735;border-color:#243061}
    .tense-item .dot{width:8px;height:8px;border-radius:50%;background:var(--brand)}

    /* Main */
    .main{display:grid;gap:16px}
    .controls{display:grid;gap:10px;background:linear-gradient(180deg,#12193a,#0f1836);border:1px solid #243061;border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .input{flex:1;display:flex;align-items:center;gap:10px;background:#0c1533;border:1px solid #233060;border-radius:12px;padding:10px 12px}
    .input input{all:unset;flex:1}
    .chip{border:1px solid #233060;background:var(--chip);padding:8px 10px;border-radius:999px;font-size:12px;cursor:pointer}
    .chip.active{outline:2px solid var(--brand);background:linear-gradient(180deg,#1b2660,#141e4a)}

    .slide{background:linear-gradient(180deg,#11183a,#0e1632);border:1px solid #243061;border-radius:var(--radius);box-shadow:var(--shadow);padding:18px;display:grid;gap:10px}
    .slide .title{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .tag{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid #2d3a77;background:#0f1739;color:#c7d4ff}
    .grid{display:grid;grid-template-columns: 1.3fr 1fr; gap:14px}
    .panel{background:#0a1330;border:1px solid #223060;border-radius:14px;padding:12px}
    .panel h4{margin:0 0 6px 0;font-size:14px;color:#b4c5ff}
    .examples{display:grid;gap:8px}
    .ex{display:grid;gap:6px;border-bottom:1px dashed #233060;padding-bottom:8px}
    .ex:last-child{border-bottom:none}
    .ex .en{font-weight:600}
    .ex .pt{color:#c7d4ff}

    .timeline{position:relative;height:8px;background:#0d1540;border:1px solid #223060;border-radius:999px;margin-top:6px}
    .pos{position:absolute;top:-5px;width:14px;height:14px;border:2px solid #223060;border-radius:999px;background:var(--brand)}
    .legend{display:flex;justify-content:space-between;font-size:11px;color:#aab7ee;margin-top:4px}

    .nav{display:flex;justify-content:space-between;gap:10px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid #2b386f;background:#0f1738;color:#eaf0ff;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}

    .pill{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:#0b153a;border:1px solid #233060;font-size:12px}
    .badge{padding:2px 8px;border-radius:8px;background:#0b153a;border:1px solid #2a3870;color:#cfe0ff;font-size:12px}

    @media (max-width: 980px){
      .app{grid-template-columns:1fr}
      .side{position:relative;height:auto}
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="side" id="sidebar">
      <header>
        <div class="logo">
          <div class="spark"><span class="material-symbols-outlined">bolt</span></div>
          <div>
            <div style="font-weight:700;letter-spacing:.2px">EN↔PT Tense Navigator</div>
            <div class="muted" style="font-size:12px;">Logic-first analogies for real-life use</div>
          </div>
        </div>
      </header>
      <div class="tense-list" id="tenseList"></div>
    </aside>

    <main class="main">
      <section class="controls">
        <div class="row">
          <div class="input" title="Search by example, logic, Portuguese mapping, or form">
            <span class="material-symbols-outlined">search</span>
            <input id="q" placeholder="Search tenses, e.g. 'já', 'há 3 anos', 'plan', 'experience', 'vou'" />
          </div>
          <button class="btn" id="reset"><span class="material-symbols-outlined">restart_alt</span>Reset</button>
        </div>
        <div class="row" id="chips"></div>
      </section>

      <article id="slide"></article>

      <div class="nav">
        <button class="btn" id="fullscreen"><span class="material-symbols-outlined">fullscreen</span>Full&nbsp;Screen</button>
        <button class="btn" id="prev"><span class="material-symbols-outlined">arrow_back</span>Prev</button>
        <div class="pill"><span class="material-symbols-outlined">slideshow</span><span id="pos">1 / N</span></div>
        <button class="btn" id="next">Next<span class="material-symbols-outlined">arrow_forward</span></button>
      </div>

      <footer class="muted" style="font-size:12px;text-align:center;padding:10px 0 30px;">
        Built for Aden • Tip: Use ← → to navigate, and type Portuguese hints like “já / venho / vou / há 3 anos”.
      </footer>
    </main>
  </div>

  <script>
    // --- Mini formatter for **bold** and ~~strike~~ ------------------------
    function fmt(txt){
      return txt
        .replace(/\*\*(.+?)\*\*/g,'<strong>$1<\/strong>')
        .replace(/~~(.+?)~~/g,'<del>$1<\/del>');
    }

    // --- Data Model ---------------------------------------------------------
    /**
     * Each card focuses on LOGIC, then gives PT mapping patterns.
     * timeline: 0 = past, 50 = now, 100 = future.
     */
    const TENSES = [
      {
        id: 'simple-present',
        name: 'Simple Present',
        form: 'S + V (base) | 3rd sg: -s/-es',
        logic: 'Habit, routine, general truth, schedules. English uses Simple Present for habits; Portuguese usually uses Presente do Indicativo ("eu como"). For fixed timetables, EN uses Simple Present where PT often still uses present ("o voo sai às 7").',
        ptMap: [
          '<strong>Hábito</strong>: Presente do Indicativo (eu/ele trabalha). Pode reforçar com <em>costumar</em>: "Costumo ir".',
          '<strong>Fatos gerais</strong>: "A água ferve a 100 °C."',
          '<strong>Horários fixos</strong>: "O ônibus sai às 6." (EN também usa presente para amanhã se for horário oficial)'
        ],
        tags: ['habit','routine','general truth','schedule','present','costumar','horário','simple'],
        examples: [
          { en: 'I work from home.', pt: 'Eu trabalho de casa.' },
          { en: 'She plays tennis on Mondays.', pt: 'Ela joga tênis às segundas.' },
          { en: 'The train leaves at 6.', pt: 'O trem sai às 6.' }
        ],
        timeline: 45
      },
      {
        id: 'present-continuous',
        name: 'Present Continuous',
        form: 'S + am/is/are + V-ing',
        logic: 'Action in progress RIGHT NOW or temporary period. In PT, use "estar + gerúndio" (estou fazendo) or sometimes simple present when context makes it obvious.',
        ptMap: [
          '<strong>Agora/temporário</strong>: Estar + gerúndio ("Estou estudando agora").',
          '<strong>PT pode usar presente simples</strong> quando o contexto já indica agora.'
        ],
        tags: ['now','temporary','ongoing','presente contínuo','estou','gerúndio'],
        examples: [
          { en: "I'm studying right now.", pt: 'Estou estudando agora.' },
          { en: "They're living with friends this month.", pt: 'Eles estão morando com amigos este mês.' }
        ],
        timeline: 50
      },
      {
        id: 'present-perfect',
        name: 'Present Perfect',
        form: 'S + have/has + V-ed (past participle)',
        logic: 'Links past to present WITHOUT a finished past time. Core logics: (1) EXPERIÊNCIA (<strong>Have you ever...?</strong>) ~ PT: "já" ("Você já..."); (2) RESULTADO AGORA ("I have lost my keys") ~ PT: perfeito simples com efeito presente; (3) COMEÇOU NO PASSADO E AINDA IMPORTA AGORA (sem data fechada).',
        ptMap: [
          '<strong>Experiência de vida</strong>: "Have you ever...?" → "Você já...?" | "I have been to X" → "Eu já fui/estive em X".',
          '<strong>Resultado agora</strong>: "She has finished" → "Ela terminou (agora/pronto)".',
          '<strong>Sem tempo fechado</strong>: Evitar datas passadas explícitas (ontem, em 2020).',
          '<strong>Since vs. For</strong>: em EN usa Present Perfect com <em>since</em> (ponto inicial) e <em>for</em> (duração). Em PT, normalmente Presente: "Moro aqui <u>desde</u> 2018" / "Moro aqui <u>há</u> 7 anos".'
        ],
        tags: ['experience','result','present link','já','sem data','ever','have been to','since','for'],
        examples: [
          { en: 'Have you ever tried sushi?', pt: 'Você já experimentou sushi?' },
          { en: 'I have been to New York three times.', pt: 'Eu já fui a Nova York três vezes.' },
          { en: 'She has finished the report.', pt: 'Ela terminou o relatório (e está pronto agora).' },
          { en: 'I have lived here since 2018.', pt: 'Moro aqui desde 2018.' },
          { en: 'I have lived here for seven years.', pt: 'Moro aqui há sete anos.' }
        ],
        timeline: 40
      },
      {
        id: 'present-perfect-cont',
        name: 'Present Perfect Continuous',
        form: 'S + have/has + been + V-ing',
        logic: 'Duração que começou no passado e continua até AGORA; foco em processo/recência. Em PT, pense: (a) "estou ... há X" / "faz X que estou ..."; (b) "tenho + particípio" é raro no Brasil; (c) "ando/venho + gerúndio" para hábito recente.',
        ptMap: [
          '<strong>Duração contínua</strong>: "Tenho trabalhado" (mais formal) / "Ando/venho trabalhando" / "Estou trabalhando há X".',
          '<strong>Since vs. For</strong>: since = ponto inicial → "desde"; for = duração → "há / por".',
          '<strong>Uso natural</strong>: muitas vezes o PT usa Presente contínuo/simples com "há"/"desde".'
        ],
        tags: ['duration','since','for','process','há','faz','venho','ando'],
        examples: [
          { en: 'I have been eating a lot recently.', pt: 'Ando/venho comendo muito ultimamente. / Estou comendo muito há um tempo.' },
          { en: 'She has been working here for five years.', pt: 'Ela trabalha aqui há cinco anos. / Está trabalhando aqui há cinco anos.' },
          { en: 'We have been waiting since 2 pm.', pt: 'Estamos esperando desde as 14h.' }
        ],
        timeline: 48
      },
      {
        id: 'simple-past',
        name: 'Simple Past',
        form: 'S + V-ed / irregular form',
        logic: 'Ação COMPLETA em tempo PASSADO definido (ontem, em 2020). PT: Pretérito Perfeito simples ("fui", "comi").',
        ptMap: [
          '<strong>Passado fechado</strong>: ontem, na semana passada, em 2020.',
          '<strong>PT</strong>: Pretérito Perfeito (fui, comi, trabalhei).'
        ],
        tags: ['finished','past time','ontem','em 2020','pretérito perfeito'],
        examples: [
          { en: 'We watched the game yesterday.', pt: 'A gente assistiu ao jogo ontem.' },
          { en: 'She bought a new laptop last week.', pt: 'Ela comprou um notebook na semana passada.' }
        ],
        timeline: 20
      },
      {
        id: 'past-continuous',
        name: 'Past Continuous',
        form: 'S + was/were + V-ing',
        logic: 'Ação em progresso em um momento do passado; cenário de fundo quando algo aconteceu. PT: "estava + gerúndio" / "eu estava fazendo quando..."',
        ptMap: [
          '<strong>Cenário de fundo</strong>: "Eu estava estudando quando ele ligou".'
        ],
        tags: ['background','interrupted','ongoing past','estava'],
        examples: [
          { en: 'I was cooking when she arrived.', pt: 'Eu estava cozinhando quando ela chegou.' },
          { en: 'They were driving at 8 pm.', pt: 'Eles estavam dirigindo às 20h.' }
        ],
        timeline: 25
      },
      {
        id: 'past-perfect',
        name: 'Past Perfect',
        form: 'S + had + V-ed',
        logic: 'Passado do passado. Uma ação A terminou ANTES de outra ação B no passado. Em PT: "já tinha + particípio".',
        ptMap: [
          '<strong>Anterioridade</strong>: "Eu já tinha terminado quando ele chegou".'
        ],
        tags: ['sequence','anteriority','antes de','já tinha'],
        examples: [
          { en: 'I had finished when he arrived.', pt: 'Eu já tinha terminado quando ele chegou.' },
          { en: 'She had never seen snow before 2010.', pt: 'Ela nunca tinha visto neve antes de 2010.' }
        ],
        timeline: 18
      },
      {
        id: 'future-will',
        name: 'Future: will',
        form: 'S + will + V (base)',
        logic: 'Decisão espontânea, promessa, oferta, previsão sem evidência. Em PT muitas vezes vira "vou" no uso real, mas a lógica é: surge na hora ("Ok, eu faço").',
        ptMap: [
          '<strong>Decisão no momento</strong>: "Ok, eu faço".',
          '<strong>Promessa/oferta</strong>: "Eu te ligo".',
          '<strong>Previsão geral</strong>: "Acho que vai chover" (EN: will).'
        ],
        tags: ['spontaneous','promise','offer','prediction','will'],
        examples: [
          { en: "I'll help you with that.", pt: 'Eu te ajudo com isso agora.' },
          { en: "I think it will rain tomorrow.", pt: 'Acho que vai chover amanhã.' }
        ],
        timeline: 75
      },
      {
        id: 'future-going-to',
        name: 'Future: going to',
        form: 'S + am/is/are + going to + V',
        logic: 'Plano/Intenção prévia ou previsão com evidência. Em PT: "vou + infinitivo" cobre bem (plano).',
        ptMap: [
          '<strong>Plano/intenções</strong>: "Vou trabalhar/estudar".',
          '<strong>Evidência visível</strong>: "Olha as nuvens, vai chover".'
        ],
        tags: ['plan','intention','evidence','vou','going to'],
        examples: [
          { en: 'I am going to start a course next week.', pt: 'Eu vou começar um curso semana que vem.' },
          { en: "Look at those clouds—it's going to rain.", pt: 'Olha aquelas nuvens — vai chover.' }
        ],
        timeline: 80
      },
      {
        id: 'present-cont-future',
        name: 'Present Continuous (Future plan)',
        form: 'S + am/is/are + V-ing + time ref',
        logic: 'Compromisso/arranjo agendado e pessoal (reunião, encontro). Em PT: geralmente "vou + infinitivo" ou só contexto com tempo futuro.',
        ptMap: [
          '<strong>Arranjo concreto</strong>: "Vou encontrar a Ana amanhã às 3" / "Tenho reunião amanhã às 9".'
        ],
        tags: ['arranged','calendar','near future','agenda'],
        examples: [
          { en: "I'm meeting Ana tomorrow at 3.", pt: 'Vou encontrar a Ana amanhã às 3.' },
          { en: "We're having dinner with them tonight.", pt: 'Vamos jantar com eles hoje à noite.' }
        ],
        timeline: 70
      },
      {
        id: 'simple-present-schedule',
        name: 'Simple Present (Schedules)',
        form: 'S + V (base) [future time]',
        logic: 'Horários fixos/programações oficiais (voos, aulas). EN usa presente simples com referência futura. PT também usa presente: "a aula começa amanhã às 8".',
        ptMap: [
          '<strong>Programações oficiais</strong>: "O voo sai às 7 amanhã" / "A aula começa às 8 na terça".'
        ],
        tags: ['timetable','schedule','fixed','programação'],
        examples: [
          { en: 'The flight leaves at 7 tomorrow.', pt: 'O voo sai às 7 amanhã.' },
          { en: 'Our class starts at 8 on Tuesday.', pt: 'Nossa aula começa às 8 na terça.' }
        ],
        timeline: 65
      }
    ];

    const CHIPS = [
      { id:'past', label:'Past', filter: t => t.timeline < 40 },
      { id:'present', label:'Present', filter: t => t.timeline >= 40 && t.timeline <= 60 },
      { id:'future', label:'Future', filter: t => t.timeline > 60 },
      { id:'habit', label:'Habit/Routine', filter: t => t.tags.includes('habit')||t.tags.includes('routine') },
      { id:'duration', label:'Duration (há/for/since)', filter: t => t.tags.includes('duration') || t.tags.includes('since') || t.tags.includes('for') },
      { id:'plan', label:'Plan/Intention', filter: t => t.tags.includes('plan')||t.tags.includes('arranged')||t.tags.includes('intention') },
      { id:'experience', label:'Experience (já/ever)', filter: t => t.tags.includes('experience') || t.tags.includes('ever') || t.tags.includes('have been to') },
      { id:'result', label:'Result now', filter: t => t.tags.includes('result') },
    ];

    // --- State --------------------------------------------------------------
    let index = 0;
    let active = [...TENSES];
    let activeChipIds = new Set();

    // --- DOM ----------------------------------------------------------------
    const tenseList = document.getElementById('tenseList');
    const slide = document.getElementById('slide');
    const pos = document.getElementById('pos');
    const q = document.getElementById('q');
    const chips = document.getElementById('chips');

    function renderSidebar(list){
      tenseList.innerHTML = '';
      list.forEach((t,i)=>{
        const item = document.createElement('div');
        item.className = 'tense-item' + (i===index?' active':'');
        item.innerHTML = `<div class="dot"></div><div><div style="font-weight:600">${t.name}</div><div class="muted" style="font-size:12px">${t.form}</div></div>`;
        item.addEventListener('click',()=>{ index = i; render(); });
        tenseList.appendChild(item);
      })
    }

    function timelineBar(value){
      return `
        <div class="timeline"><div class="pos" style="left:${value}%"></div></div>
        <div class="legend"><span>Past</span><span>Now</span><span>Future</span></div>
      `;
    }

    function renderSlide(t){
      slide.className = 'slide';
      slide.innerHTML = `
        <div class="title">
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
            <h2 style="margin:0">${t.name}</h2>
            <span class="badge">${t.form}</span>
          </div>
          <div class="tag">Logic-first</div>
        </div>

        <div class="grid">
          <div class="panel">
            <h4>Logic (how to use it)</h4>
            <div class="muted" style="line-height:1.55">${fmt(t.logic)}</div>
            ${timelineBar(t.timeline)}
          </div>
          <div class="panel">
            <h4>Portuguese mappings (by sense)</h4>
            <ul style="margin:0;padding-left:18px;line-height:1.7">
              ${t.ptMap.map(x=>`<li>${fmt(x)}</li>`).join('')}
            </ul>
          </div>
        </div>

        <div class="panel">
          <h4>Examples</h4>
          <div class="examples">
            ${t.examples.map(ex=>`
              <div class="ex">
                <div class="en">${fmt(ex.en)}</div>
                <div class="pt">${fmt(ex.pt)}</div>
              </div>
            `).join('')}
          </div>
        </div>

        <div class="panel">
          <h4>Common pitfalls (EN ↔ PT)</h4>
          <ul style="margin:0;padding-left:18px;line-height:1.7">
            ${buildPitfalls(t.id)}
          </ul>
        </div>
      `;
    }

    function buildPitfalls(id){
      const lines = {
        'present-perfect': [
          'Não use com tempo passado fechado: ❌ “I have visited in 2020” → ✅ “I visited in 2020”.',
          'Para EXPERIÊNCIA, use “já”: “I have been to NY” → “Eu já fui/estive em NY”.',
          'Para RESULTADO AGORA, PT pode usar perfeito simples: “I have lost my keys” → “Perdi minhas chaves (agora)”.'
        ],
        'present-perfect-cont': [
          'Prefira “estou/venho/ando + gerúndio” em vez de “tenho + particípio” no BR.',
          'Marque duração com “há/faz” ou “desde”: “I have been working here for 5 years” → “Trabalho aqui há 5 anos / desde 2019”.'
        ],
        'simple-present': [
          '3ª pessoa -s/-es: “She work” ❌ → “She works” ✅.',
          'Horários fixos em EN usam presente, não futuro: “The bus leaves at 6 tomorrow”.'
        ],
        'present-continuous': [
          'Evite usar para hábito: presente contínuo é temporário ou “agora”.',
          'Português às vezes usa presente simples onde EN exige -ing.'
        ],
        'simple-past': [
          'Use para passado FECHADO (ontem, em 2020). Se houver conexão com o presente, avalie Present Perfect.'
        ],
        'past-continuous': [
          'Use para cenário de fundo: “I was studying when he called”.'
        ],
        'past-perfect': [
          'Só faz sentido com outra âncora no passado: A já tinha acontecido quando B ocorreu.'
        ],
        'future-will': [
          'Decisão no momento da fala e promessas. Para planos, prefira “going to” ou presente contínuo.',
          'Em PT, muitas vezes vira “vou” no uso real.'
        ],
        'future-going-to': [
          'Plano já decidido. Para agenda pessoal próxima, presente contínuo também funciona: “I\'m meeting Ana tomorrow”.'
        ],
        'present-cont-future': [
          'Exige referência de tempo futuro. É um ARRANJO concreto (agenda).'
        ],
        'simple-present-schedule': [
          'Use para horários oficiais. Para intenções pessoais, prefira “going to”/presente contínuo.'
        ]
      }[id] || ['Sem armadilhas específicas. Foque na lógica.'];
      return lines.map(x => `<li>${fmt(x)}</li>`).join('');
    }

    function render(){
      renderSidebar(active);
      if(index<0) index=0;
      if(index>=active.length) index = Math.max(0, active.length-1);
      const t = active[index];
      if(!t){
        slide.innerHTML = `<div class="slide"><div class="muted">No results. Try clearing filters.</div></div>`;
        pos.textContent = '0 / 0';
        return;
      }
      renderSlide(t);
      pos.textContent = `${index+1} / ${active.length}`;
    }

    // --- Filters & Search ---------------------------------------------------
    function matchesQuery(t, query){
      if(!query) return true;
      const hay = [t.name, t.form, t.logic, t.ptMap.join(' '), t.tags.join(' '), t.examples.map(e=>e.en+" "+e.pt).join(' ')].join(' ').toLowerCase();
      return hay.includes(query.toLowerCase());
    }

    function applyFilters(){
      const term = q.value.trim();
      const pool = TENSES.filter(t => matchesQuery(t, term));
      if(activeChipIds.size===0){ active = pool; return; }
      // Keep only tenses that satisfy ALL active chip filters
      active = pool.filter(t => Array.from(activeChipIds).every(id => CHIPS.find(c=>c.id===id).filter(t)) );
    }

    // --- UI Wiring ----------------------------------------------------------
    document.getElementById('prev').addEventListener('click', ()=>{ index = Math.max(0, index-1); render(); });
    document.getElementById('next').addEventListener('click', ()=>{ index = Math.min(active.length-1, index+1); render(); });
    document.getElementById('reset').addEventListener('click', ()=>{ q.value=''; activeChipIds.clear(); document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active')); active=[...TENSES]; index=0; render(); });
    q.addEventListener('input', ()=>{ index=0; applyFilters(); render(); });

    // Chips
    CHIPS.forEach(ch=>{
      const el = document.createElement('button');
      el.className = 'chip';
      el.textContent = ch.label;
      el.addEventListener('click', ()=>{
        const on = el.classList.toggle('active');
        if(on) activeChipIds.add(ch.id); else activeChipIds.delete(ch.id);
        index=0; applyFilters(); render();
      });
      chips.appendChild(el);
    });

    // Keyboard navigation & Fullscreen
    window.addEventListener('keydown', (e)=>{
      if(e.key==='ArrowLeft'){ document.getElementById('prev').click(); }
      if(e.key==='ArrowRight'){ document.getElementById('next').click(); }
      if(e.key==='/' && document.activeElement!==q){ q.focus(); e.preventDefault(); }
      if(e.key==='f'){ toggleFS(); }
    });

    function toggleFS(){
      if(!document.fullscreenElement){ document.documentElement.requestFullscreen(); }
      else { document.exitFullscreen(); }
    }
    document.getElementById('fullscreen').addEventListener('click', toggleFS);

    // Init
    render();
  </script>
</body>
</html>